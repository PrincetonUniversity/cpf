%\begin{lstlisting}[morekeywords={pathcost}, belowskip=0pt, firstnumber=1,
%name=dij_checks]
%int *pathcost; // dyn alloc 1-D N
%int *adj; // dyn alloc 2-D NxN
%int dist, v, src, i;

\begin{lstlisting}[morekeywords={pathcost}, belowskip=0pt, firstnumber=9, name=dij_checks]
int dequeue() {
  if (!emptyQ()) {
\end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost,dist}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
    // Privacy Local Check & Logging -- < 1% added overhead
    private_write(&dist, sizeof(int), md);
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost,dist},aboveskip=0pt,
  belowskip=0pt, firstnumber=auto,name=dij_checks,showlines=true]
    dist = ...
    ...
  }


  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost,dist},aboveskip=0pt, belowskip=0pt,
firstnumber=18,name=dij_checks]
}

void worker_loop(int start, int N, int step) {
\end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost,dist}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
  void *md = alloc(); // allocate metadata
  // Separation Local Check -- < 0.001% added overhead
  check_heap(pathcost, PRIVATE);
  check_heap(&dist, PRIVATE);
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost},aboveskip=0pt, belowskip=0pt, firstnumber=auto,name=dij_checks]
  for (src=start; src<N; src+=step) {
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
    // Privacy Local Check & Logging -- < 1% added overhead
    private_write(pathcost, N*sizeof(int), md);
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost},aboveskip=0pt, belowskip=0pt, firstnumber=auto,name=dij_checks]
    for (i=0; i<N; i++)
      pathcost[i] = inf;

    enqueue(src, 0);
    while (!emptyQ()) {
      int v = dequeue();
      for (i=0; i<N; i++) {
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost,dist}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
        // Privacy Local Check & Logging -- 11.4% added overhead
        private_read(&dist, sizeof(int), md);
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost,dist}, aboveskip=0pt, belowskip=0pt, firstnumber=auto,name=dij_checks]
        nDist = adj[v][i] + dist;
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
        // Privacy Local Check & Logging -- 11.6% added overhead
        private_read(&pathcost[i], sizeof(int), md);
  \end{lstlisting}


  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt, belowskip=0pt, firstnumber=auto,name=dij_checks]
        if (pathcost[i] > nDist) {
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
          // Privacy Local Check & Logging -- < 1% added overhead
          private_write(&pathcost[i], sizeof(int), md);
  \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt, belowskip=0pt, firstnumber=auto,name=dij_checks]
          pathcost[i] = nDist;
          enqueue(i, nDist);
        }
      }
    }
    \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
    if (checkpointDue()) {
      // check conflicts with other workers -- < 1% added overhead
      checkPrivAcccessesConflicts(md);
    }
  \end{lstlisting}

\begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt, belowskip=0pt, firstnumber=auto,name=dij_checks]
  }
    \end{lstlisting}

  \begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt,belowskip=0pt,backgroundcolor=\color{lightgray},
  firstnumber=auto, name=dij_checks]
  communicateLiveOutMemState(md); // < 1% added overhead
  \end{lstlisting}

\begin{lstlisting}[morekeywords={pathcost}, aboveskip=0pt, belowskip=0pt,
firstnumber=auto,name=dij_checks]
}
\end{lstlisting}
